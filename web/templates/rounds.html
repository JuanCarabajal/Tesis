{% extends "base.html" %}

{# ---------------- Server-side data selection (sin window.*) ---------------- #}
{# R: lista de rondas; puede venir de fixtures.roundsSample, fb.roundsSample o notes #}
{% set R = (
    fixtures.roundsSample
      if fixtures is defined and fixtures.roundsSample is defined
      else (fb.roundsSample if fb is defined and fb.roundsSample is defined
            else (notes if notes is defined else []))
) %}

{% block content %}
  <div class="mb-4 flex items-center justify-between">
    <h2 class="text-2xl font-semibold">Rondas (muestra)</h2>
    {% if match_id is defined and match_id %}
      <span class="rounded-full bg-sky-500/10 px-3 py-1 text-xs text-sky-300 ring-1 ring-sky-400/20">
        Match: {{ match_id }}
      </span>
    {% else %}
      <span class="rounded-full bg-sky-500/10 px-3 py-1 text-xs text-sky-300 ring-1 ring-sky-400/20">
        Prototype · datos simulados
      </span>
    {% endif %}
  </div>

  <div class="rounded-2xl bg-zinc-900/60 p-4 ring-1 ring-white/10">
    <div class="overflow-x-auto">
      <table class="w-full text-left text-sm text-zinc-300">
        <thead class="text-xs text-zinc-400">
          <tr>
            <th class="py-2 pr-4">Ronda</th>
            <th class="py-2 pr-4">end_ts</th>
            <th class="py-2 pr-4">plant_ts</th>
            <th class="py-2 pr-4">plant_site</th>
            <th class="py-2 pr-4">plant_zone_id</th>
          </tr>
        </thead>
        <tbody>
          {% if R and R|length %}
            {% for r in R %}
            <tr class="border-t border-white/5">
              {# Soporta dos formatos:
                 - fixtures: dict con claves round/end_ts/plant_ts/plant_site/plant_zone_id
                 - notes:   podría traer otras claves; si no están, mostramos vacío #}
              <td class="py-2 pr-4 text-zinc-400">
                {{ r.round if r.round is defined else (r['round'] if 'round' in r else loop.index) }}
              </td>
              <td class="py-2 pr-4 text-zinc-400">
                {% set et = (r.end_ts if r.end_ts is defined else (r['end_ts'] if 'end_ts' in r else None)) %}
                {{ ('%.3f'|format(et)) if et is not none else '' }}
              </td>
              <td class="py-2 pr-4 text-zinc-400">
                {% set pt = (r.plant_ts if r.plant_ts is defined else (r['plant_ts'] if 'plant_ts' in r else None)) %}
                {{ ('%.3f'|format(pt)) if pt is not none else '' }}
              </td>
              <td class="py-2 pr-4">
                {% set ps = (r.plant_site if r.plant_site is defined else (r['plant_site'] if 'plant_site' in r else '')) %}
                {% if ps == 'A' %}
                  <span class="rounded-full bg-sky-500/10 px-2 py-0.5 text-xs text-sky-300 ring-1 ring-sky-400/30">A</span>
                {% elif ps == 'B' %}
                  <span class="rounded-full bg-violet-500/10 px-2 py-0.5 text-xs text-violet-300 ring-1 ring-violet-400/30">B</span>
                {% else %}
                  <span class="text-zinc-500 text-xs">—</span>
                {% endif %}
              </td>
              <td class="py-2 pr-4" title="Zona del plant">
                {% set pz = (r.plant_zone_id if r.plant_zone_id is defined else (r['plant_zone_id'] if 'plant_zone_id' in r else '')) %}
                {{ pz }}
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr><td colspan="5" class="py-4 text-zinc-500">Sin datos de rondas.</td></tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
